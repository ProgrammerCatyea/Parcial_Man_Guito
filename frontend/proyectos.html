<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Proyectos ‚Äì Parcial_Man_Guito</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>

<header>
    <h1> Gesti√≥n de Proyectos</h1>
</header>

<main>
    <section class="formulario">
        <h2>Agregar Proyecto</h2>
        <form id="formProyecto">
            <input type="text" id="nombre" placeholder="Nombre del proyecto" required>
            <input type="text" id="descripcion" placeholder="Descripci√≥n" required>
            <input type="text" id="plataforma" placeholder="Plataforma (ej: Web, M√≥vil)" required>
            <input type="number" id="presupuesto" placeholder="Presupuesto ($)" required>
            <button type="submit"> Crear Proyecto</button>
        </form>
    </section>

    <section class="lista">
        <h2>Lista de Proyectos Activos</h2>
        <div id="listaProyectos"></div>
    </section>

    <section class="reportes">
        <h2> Reporte de Proyectos Eliminados</h2>
        <button id="descargarReporte">‚¨á Descargar Reporte</button>
    </section>
</main>

<footer>
    <a href="./index.html">üè† Volver al inicio</a>
</footer>

<script>
const baseURL = "http://127.0.0.1:8000";
const lista = document.getElementById("listaProyectos");
const form = document.getElementById("formProyecto");
const botonReporte = document.getElementById("descargarReporte");


form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const nuevo = {
        nombre: document.getElementById("nombre").value,
        descripcion: document.getElementById("descripcion").value,
        plataforma: document.getElementById("plataforma").value,
        presupuesto: parseFloat(document.getElementById("presupuesto").value)
    };

    const res = await fetch(`${baseURL}/proyectos/`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(nuevo)
    });

    if (res.ok) {
        alert(" Proyecto creado correctamente");
        form.reset();
        cargarProyectos();
    } else {
        alert(" Error al crear proyecto");
    }
});


async function cargarProyectos() {
    const res = await fetch(`${baseURL}/proyectos/`);
    const data = await res.json();
    lista.innerHTML = `
        <table>
            <tr><th>ID</th><th>Nombre</th><th>Descripci√≥n</th><th>Plataforma</th><th>Presupuesto</th><th>Acci√≥n</th></tr>
            ${data.map(p => `
                <tr>
                    <td>${p.id}</td>
                    <td>${p.nombre}</td>
                    <td>${p.descripcion}</td>
                    <td>${p.plataforma}</td>
                    <td>$${p.presupuesto.toLocaleString()}</td>
                    <td><button onclick="eliminarProyecto(${p.id})">üóë Eliminar</button></td>
                </tr>`).join("")}
        </table>
    `;
}

async function eliminarProyecto(id) {
    const confirmar = confirm("¬øSeguro que deseas eliminar este proyecto?");
    if (confirmar) {
        await fetch(`${baseURL}/proyectos/${id}`, { method: "DELETE" });
        alert("üóë Proyecto eliminado");
        cargarProyectos();
    }
}

botonReporte.addEventListener("click", () => {
    const link = document.createElement("a");
    link.href = `${baseURL}/proyectos/reporte/eliminados`;
    link.download = "reporte_proyectos_eliminados.txt";
    link.click();
});

cargarProyectos();
</script>

</body>
</html>
