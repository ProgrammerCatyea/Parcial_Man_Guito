<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Miembros – Parcial_Man_Guito</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>

<header>
    <h1> Gestión de Miembros</h1>
</header>

<main>
    <section class="formulario">
        <h2>Agregar Miembro</h2>
        <form id="formMiembro">
            <input type="text" id="nombre" placeholder="Nombre del miembro" required>
            <input type="email" id="correo" placeholder="Correo electrónico" required>
            <input type="text" id="rol" placeholder="Rol (ej: Desarrollador, Líder)" required>
            <button type="submit"> Crear Miembro</button>
        </form>
    </section>

    <section class="lista">
        <h2>Lista de Miembros Activos</h2>
        <div id="listaMiembros"></div>
    </section>
</main>

<footer>
    <a href="./index.html"> Volver al inicio</a>
</footer>

<script src="./js/app.js"></script>
<script>
const baseURL = "http://127.0.0.1:8000";
const lista = document.getElementById("listaMiembros");
const form = document.getElementById("formMiembro");

form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const nuevo = {
        nombre: document.getElementById("nombre").value,
        correo: document.getElementById("correo").value,
        rol: document.getElementById("rol").value
    };

    const res = await fetch(`${baseURL}/miembros/`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(nuevo)
    });

    if (res.ok) {
        alert(" Miembro creado correctamente");
        form.reset();
        cargarMiembros();
    } else {
        alert(" Error al crear miembro");
    }
});

async function cargarMiembros() {
    const res = await fetch(`${baseURL}/miembros/`);
    const data = await res.json();
    lista.innerHTML = `
        <table>
            <tr><th>ID</th><th>Nombre</th><th>Correo</th><th>Rol</th><th>Acción</th></tr>
            ${data.map(m => `
                <tr>
                    <td>${m.id}</td>
                    <td>${m.nombre}</td>
                    <td>${m.correo}</td>
                    <td>${m.rol}</td>
                    <td><button onclick="eliminarMiembro(${m.id})">Eliminar</button></td>
                </tr>`).join("")}
        </table>
    `;
}

async function eliminarMiembro(id) {
    if (confirm("¿Estás seguro de eliminar este miembro?")) {
        await fetch(`${baseURL}/miembros/${id}`, { method: "DELETE" });
        alert(" Miembro eliminado");
        cargarMiembros();
    }
}

cargarMiembros();
</script>

</body>
</html>
